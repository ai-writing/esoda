{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load add_tense %}

{% block title %}ESODA | search result{% endblock %}

{% block head %}
  <!-- <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <!-- <link href="//apps.bdimg.com/libs/fontawesome/4.4.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="{% static 'css/jquery.mCustomScrollbar.min.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}

  <div class="result-page">
    <div class="container">
      <div class="row">
        <div class="col-lg-2 col-md-2 col-sm-3">
          <div class="hidden-xs">
            {% if r.hasSyn or r.collocationList %}
              <div id="SidebarAffix" class="affix" data-spy="affix">
                <div class="panel-group">
                  <div class="tab-content CollapseColloc panel panel-default">
                    {% if r.collocationList %}
                      <div role="tabpanel" class="tab-pane fade in" id="CollocAll"></div>
                      {% for collocation in r.collocationList.cL %}
                        <div role="tabpanel" class="tab-pane fade usage-pane" id="{{ collocation.label }}"></div>
                      {% endfor %}
                    {% endif %}
                  </div>
                </div>
                <i class="fa fa-spinner fa-pulse fa-lg fa-fw"></i>
              </div>
            {% endif %}
          </div>
        </div>

        <div class="col-lg-10 col-md-10 col-sm-9 result-main">
          <div class="panel-group" role="tablist" aria-multiselectable="true">
            {% if dictionary.explanationList %}
              {% include "esoda/dictionary_result.html" %}
            {% endif %}

            <div class="result-warning hidden">
              {% if not user.is_authenticated %}
                默认搜索领域为"<span>计算机全部领域</span>"，您尚未设置个人领域，<a href="#" data-toggle="modal" data-target="#ModalLogin">登录</a>
                进行个性化搜索
              {% else %}
                {% if r.domain|upper %}
                  当前个人领域为“<span>{{ r.domain|upper }}</span>”，在<a href="{% url 'authentication:domain' %}">其他个人领域</a>中搜索
                {% else %}
                  您尚未设置个人领域{{ r.domain|upper }}，<a href="{% url 'authentication:domain' %}">添加个人领域</a>进行个性化搜索
                {% endif %}
              {% endif %}
            </div>

            <div class="CollapseColloc row {% if r.tlen > 2 or not r.collocationList %}hidden{% endif %}" role="tabpanel" aria-labelledby="HeadingColloc">
              <ul class="colList nav nav-tabs nav-tabs-collocation col-lg-11 col-md-11 col-sm-11 col-xs-11"
                    role="tablist">
                {% for collocation in r.collocationList.cL %}
                  <li class="second-row" role="presentation">
                    <a href="#{{ collocation.label }}" class="colloc-sub-btn" role="tab"
                         {% if forloop.counter == r.collocationList.index %} id="first"{% endif %}
                           data-toggle="tab" data="{{ collocation.t_dt.0 }}" type="{{ collocation.type }}" expand="{{ expand }}">
                        {% if collocation.t_dt.1 == '0' %}全部例句
                          <p>{% for word in collocation.t_dt.0 %}{{ word|cut:"*" }} {% endfor %}</p>
                        {% elif collocation.t_dt.1 == '1' %}主谓例句
                          <p>{% for word in collocation.t_dt.0 %}
                            {% if collocation.t_dt.0|first == '*' and word != '*' %}主语 + {{ word }}
                            {% elif collocation.t_dt.0|last == '*' and word != '*' %}{{ word }} + 动词
                            {% else %}{{ word|cut:"*" }} {% endif %}
                          {% endfor %}</p>
                        {% elif collocation.t_dt.1 == '2' %}动宾例句
                          <p>{% for word in collocation.t_dt.0 %}
                            {% if collocation.t_dt.0|first == '*' and word != '*' %}动词 + {{ word }}
                            {% elif collocation.t_dt.0|last == '*' and word != '*' %}{{ word }} + 宾语
                            {% else %}{{ word|cut:"*" }} {% endif %}
                          {% endfor %}</p>
                        {% elif collocation.t_dt.1 == '3' %}修饰例句
                          <p>{% for word in collocation.t_dt.0 %}
                            {% if collocation.t_dt.0|first == '*' and word != '*' %}修饰词 + {{ word}}
                            {% elif collocation.t_dt.0|last == '*' and word != '*' %}{{ word }} + 被修饰词
                            {% elif word == collocation.t_dt.0.0 %}{{ word|cut:"*"|add_tense }}
                            {% else %}{{ word|cut:"*" }} {% endif %}
                          {% endfor %}</p>
                        {% elif collocation.t_dt.1 == '4' %}介词例句
                          <p>{% for word in collocation.t_dt.0 %}
                            {% if collocation.t_dt.0|first == '*' and word != '*' %}介词 + {{ word }}
                            {% elif collocation.t_dt.0|last == '*' and word != '*' %}{{ word }} + 介词
                            {% else %}{{ word|cut:"*" }} {% endif %}
                          {% endfor %}</p>
                        {% endif %}
                    </a>
                  </li>
                {% endfor %}
              </ul>
              <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1 list-btn2 {% if r.collocationList.cL|length <= 3 or not r.collocationList %}hidden{% endif %}">
                <div id="colMore"><i class="fa fas fa-angle-down"></i></div>
                <div id="colLess"><i class="fa fas fa-angle-up"></i></div>
              </div>
            </div>

            <div id="SentenceLoading" class="result-table-cell center-align">
              <p><i class="fa fa-spinner fa-pulse fa-lg fa-fw"></i><span>正在加载</span></p>
            </div>

            <div id="Loading" class="result-table-cell center-align">
              <p><i class="fa fa-spinner fa-pulse fa-lg fa-fw"></i><span>正在加载</span></p>
            </div>

            <div id="SentenceResult"></div>

            <div id="Loading2" class="result-table-cell center-align">
              <p><i class="fa fa-spinner fa-pulse fa-lg fa-fw"></i><span>正在加载</span></p>
            </div>

            <div id="Loadbox" class="result-table-cell center-align">
              <p id="ManualLoad">点击加载更多</p>
            </div>

            <div class="fix-right-xs">
              <div id="Feedback" class="affix feedback-affix" data-spy="affix">
                <div class="btn feedback" data-toggle="modal" data-target="#FeedbackModal">反馈</div>
              </div>
              <div id="BackToTopAffix" class="affix back-to-top-affix" data-spy="affix">
                <div class="btn back-to-top">
                  <p class="glyphicon glyphicon-chevron-up"></p>
                  <p>回到顶部</p>
                </div>
              </div>
            </div>

            <div class="modal fade" id="FeedbackModal">
              <div class="modal-dialog modal-sm modal-login-sm" id="feedback-modal">
                <div class="modal-content">
                  <div class="modal-header modal-login-header">
                    <img src="{% static 'img/logo.png' %}" class="modal-logo">
                    <h4>请提供您的意见与反馈</h4>
                  </div>
                  <div class="modal-body modal-login-body">
                    <form id="FeedbackForm" class="form-horizonal" method="post" action="{% url 'common:comment' %}">
                      {% csrf_token %}
                      <div>
                        <textarea form="FeedbackForm" name="comment" class="form-control"></textarea>
                      </div>
                      <input type="hidden" name="next" value="{{ next }}"/>
                      <input class="btn btn-primary" type="submit" value="提交反馈"/>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div> <!-- panel-group -->
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block script %}
  <script src="{% static 'js/jquery.mousewheel.min.js' %}"></script>
  <script src="{% static 'js/jquery.mCustomScrollbar.min.js' %}"></script>
  <script src="{% static 'js/esoda-result.js' %}?v={% now 'Ymd' %}"></script>
  <script>
    REF = '{{ ref }}';
    POSS = '{{ poss }}';
    SENTENCES_URL = "{% url 'sentences' %}";
    COLLOCATION_URL = "{% url 'collocation' %}";
  </script>
{% endblock %}
